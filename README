Ffalarms
========

Ffalarms is a program to set multiple alarms a day using a finger
friendly user interface (hence the name).

Three clicks to set an alarm time.  Progressive volume.  Switch off
though four button puzzle.  LED night clock included.

Ffalarms uses an analog-like clock face to select a time of the alarm
so only one to three clicks are needed to pick a time: one to select
an hour, optional one to select a minute (if not 0), and optional one
to select AM/PM (if not AM).

The alarm starts quietly and slowly increases the volume up to the
maximum.  Thus you may be awaken by a gentle sound if your sleep is
shallow (especially if you select a nice tune as an alarm), but you
may require it to get lauder if you are in a deep sleep or hard
working and ignoring distractions from environment.

To confirm turning off the alarm you have to click four buttons with
numbers in proper order under a 5 second timeout: pretty hard to do if
you are still half-sleeping and and your sight is still unclear and
blurred (at least much harder than pushing the snooze button :)).

Ffalarms also contains a 7 segment LED-like night clock.


Author
------

≈Åukasz Pankowski <lukpank@o2.pl>


Inspirations
------------

The layout of the user interface is clearly inspired by that of Neon_
(also `on opkg.org`__), a nice and finger friendly image viewer.  The
confirmation puzzle idea is taken from Zhone_, FSO_ usable demo
application.  The 7 segment LED-like night clock is inspired by the
`LED clock`_ (`on opkg.org`__), which I have discovered on opkg.org_
while having ffalarms useable on my Neo FreeRuner (though not yet in a
releasable state).

.. _Neon: http://neon.projects.openmoko.org/
.. __: http://www.opkg.org/package_62.html
.. _Zhone: http://wiki.openmoko.org/wiki/Zhone
.. _FSO: http://www.freesmartphone.org/
.. _LED clock: http://projects.openmoko.org/projects/ledclock/,
.. __: http://www.opkg.org/package_104.html
.. _opkg.org: http://www.opkg.org/


Dependencies
------------

Mostly Python_ and EFL_.

.. _Python: http://python.org/
.. _EFL: http://enlightenment.org/p.php?p=about/efl&l=en

::

    python-edje python-ecore python-re python-datetime atd
    alsa-utils-amixer alsa-utils-alsactl openmoko-alsa-scenarios
    ttf-liberation-sans


Suggested media players
-----------------------

``mplayer`` or ``alsa-utils-aplay`` (voc, wav, raw or au only)


Features
--------

- It is developed and works on `Om 2008.12`_ and SHR_ (for SHR you
  need to install atd-over-fso from ffalarms download page to have atd
  daemon working on top of FSO_).

- Can be configured to use any media player, MPlayer_ is of course
  recommended, but it may work with aplay_ from ``alsa-utils-aplay``,
  if wav files are enough for you.  If you have ``alsa-utils-aplay``
  installed it should work out of the box.

- Adding, listing, and removing alarms is possible from command line
  (see `Command line options`_ below).

- LED clock, confirmation puzzles and analog clock alarm selection are
  completely themeable, as they are implemented in Edje_ using Embryo_
  for logic.

- It currently depends only on ``atd`` for alarm scheduling, hope it
  makes it more portable.

.. _MPlayer: http://www.mplayerhq.hu/design7/news.html
.. _aplay: http://en.wikipedia.org/wiki/Aplay
.. _Om 2008.12: http://wiki.openmoko.org/wiki/Om_2008.12_Update
.. _Edje: http://wiki.enlightenment.org/index.php/Edje
.. _Embryo: http://wiki.enlightenment.org/index.php/Embryo
.. _SHR: http://wiki.openmoko.org/wiki/SHR


Limitations
-----------

- Ffalarms knows nothing about:

  - Silent profiles: it will play the alarm any way (but on a surplus
    side you can set Silent profile for the night if you wish and it
    will not prevent the alarm to wake you up).

- Time selection:

  - There is currently no way to select a date of an alarm, it will be
    scheduled for today if the given time have not yet passed or for
    tomorrow otherwise.  This is reasonable default but an option to
    select a date from a finger friendly calendar would be nice.

  - There is currently no way to schedule periodic alarms, for example
    every day, or only on Mondays.

- Ffalarms is currently only configurable through a configuration file
  (see Configuration_ below)

- Currently the list of alarms is not refreshed if the alarms have
  been altered by another instance of ffalarms or the alarm finished.

- Configuration of LED night clock is currently limited to `12/24 hour
  mode and brightness`_.


Configuration
-------------

On `Om 2008.12`_ install ``alsa-utils-aplay`` together with
``ffalarms`` and it should work out of the box.  But if you want to
use other alarm file or player than read on.

The configuration is done through a file ``~/.ffalarmsrc``. If
configuration file does not exist or contains errors (ffalarms will
display proper message) then the default configuration is used which
is equivalent to ::

    [alarm]
    player=aplay -q %(file)s
    file=/usr/share/ffalarms/alarm.wav
    repeat=500

    [ledclock]
    24hr_format=true
    brightness=33

Which will play a given file 500 times (ie. for about 5 minutes).  But
if you have mplayer installed you can use its ``-loop`` option to
obtain the same effect (and then omit repeat as it obviously defaults
to 1) ::

    [alarm]
    player=mplayer -really-quiet -loop 500 %(file)s
    file=~/song.foo

But why would you use a WAV file if you have MPlayer installed?

Reference ``%(file)s`` in the player option will be expanded to a
value of file option with leading tilde (``~``) replaced with the home
directory and proper shell quoting if needed.

.. _12/24 hour mode and brightness:

LED clock by default uses 24 hour format, you can change it to 12 hour
format by setting ``24hr_format`` to ``false``, you can also change
brightness of the LED clock (which 33 by default, 100 is maximum), use
special value of -1 to not change the brightness, for example ::

    [ledclock]
    24hr_format=false
    brightness=-1


Command line options
--------------------

::

    Usage:
      ffalarms [OPTION...]  - finger friendly alarms

    Help Options:
      -?, --help              Show help options

    Application Options:
      -e, --edje=FILE         use Edje interface from FILE
      --at-spool=DIR          use DIR as the at spool directory instead of
      -c, --config=FILE       use config file other than ~/.ffalarmsrc
      -s, --set=HH:MM|now     set alarm at given time
      --del=TIMESTAMP         delete alarm with a given timestamp
      --kill                  kill running alarm
      -l, --list              list scheduled alarms
      --puzzle                run turn off puzzle
      --play-alarm            play alarm
      --version               display version and exit


Credits
-------

Some images are generated from SVG icons from `Tango Desktop Project`_
(licenced under the Creative Commons Attribution Share-Alike license),
this includes ``add.png``, ``remove.png``, ``go-last.png``, and
``led-clock.png`` (generated from ``stock_weather-night-clear.svg``).

Some images are generated from SVG icons available in Debian package
gnome-icon-theme_ (licenced under `GNU GPL v2`_) which says they are
available from here__, this includes go-last.png, gtk-close.png, and
ffalarms.svg (based on appointment-new.svg).

Alarm file ``alarm.wav`` is taken from `Trolltech's Qtopia`_ Open Source
edition version 4.3.2 which is licensed under `GNU GPL v2`_.

.. _Tango Desktop Project: http://tango.freedesktop.org/
.. _gnome-icon-theme: http://packages.debian.org/stable/gnome-icon-theme
.. __: http://ftp.acc.umu.se/pub/GNOME/sources/gnome-icon-theme/
.. _GNU GPL v2: http://www.gnu.org/licenses/old-licenses/gpl-2.0.html
.. _Trolltech's Qtopia: http://qtopia.net/modules/devices/


Bugs
----

I once experienced keyboard popping up on top of LED clock without
resizing it, thus covering the close button ("X"), if this ever
happens press key ``q`` to close the LED clock.


TODO
----

- add support for repeated alarms (may require to write alarm daemon
  on top of FSO may be with, optional backward (2008.12) compatible
  atd backend).

- Should preserve list selection on list update.

- The list would get more readable if the items would be of the form
  "Today 18:30", "Tomorrow 7:00" in huge letters.  Would require
  responding to change of date at midnight.

- May support "repeat=5m" for playing the alarm for five minutes
  instead of given number of times.

- may add "killing the alarm by accelerators would be an excellent
  option!"  (suggested by Vanous)


Versions
--------

0.2.2 (2009-05-22)
..................

- fix ffalarms not starting due to ecore.evas.engines_get raising
  ValueError instead of returning True (incompatibility between
  python-ecore and ecore; thanks to skamster for reporting)

- add -E, --engine=x11|x11-16 option

- check also for software_16_x11 (new name) apart from software_x11_16
  (old name)

- fix typo in "Scheduled alarms:" on main screen (thanks to Marcel)

0.2.1 (2009-03-27)
..................

- fix to a Daylight Saving Time problem (thanks to Ken Young for
  reporting this)

- disables the screensaver on the phone avoiding it to sleep while the
  alarm is ringing (thanks to Marco Trevisan for the patch)

- analog clock face now shows AM/PM hours or minutes depending on the
  context (thanks to Marco Trevisan for the patch; I reimplemented the
  idea in Embryo)

- now the puzzle is reordered after timeout instead of being hidden

- display error message if unable to trigger atd daemon

- add support for dimming the backlight in Linux 2.6.28 (as in SHR)

- include ``alarm.wav`` from Qtopia (to work out of the box on SHR)

- display error message if there is no atd spool directory instead of
  failing to start GUI

0.2 (2009-02-08)
................

- restore original ALSA state after the alarm (instead of setting stereoout)
- raise puzzle when alarm starts (unless in LED clock mode)
  (thanks to Nathan for the suggestion)
- LED clock: use bigger digits if hour < 20
- LED clock: add configuration option to select 12 or 24 time format
- adding alarm: hours become bigger when clicked for visual feedback

0.1 (2009-01-31)
................

- Initial release
